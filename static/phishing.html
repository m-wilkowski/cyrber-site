<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CYRBER ‚Äî Phishing</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --navy:    #080c18;
    --navy2:   #0c1220;
    --navy3:   #101828;
    --panel:   #0a1020;
    --accent:  #4a8fd4;
    --accent2: #7ab3e8;
    --purple:  #9b59b6;
    --silver:  #8a9bb5;
    --white:   #e8eef8;
    --border:  rgba(74,143,212,.18);
    --border2: rgba(74,143,212,.10);
    --red:     #ff4444;
    --yellow:  #f5c518;
    --green:   #3ddc84;
    --orange:  #ff8c00;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--navy);
    color: var(--white);
    font-family: 'Rajdhani', sans-serif;
    font-size: 15px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 15% 60%, rgba(20,40,80,0.55) 0%, transparent 70%),
      radial-gradient(ellipse 60% 40% at 85% 15%, rgba(10,20,50,0.7) 0%, transparent 60%),
      radial-gradient(ellipse 100% 30% at 50% 100%, rgba(74,143,212,0.04) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(74,143,212,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(74,143,212,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  nav {
    position: sticky; top: 0; z-index: 100;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 32px; height: 56px;
    background: rgba(8,12,24,.92);
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(12px);
  }

  .nav-brand {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: 'Orbitron', sans-serif;
    font-size: 18px;
    font-weight: 900;
    letter-spacing: .15em;
    color: var(--white);
    text-decoration: none;
  }

  .nav-brand span {
    font-size: 10px;
    font-weight: 400;
    color: var(--accent);
    letter-spacing: .3em;
    display: block;
    margin-top: -2px;
  }

  .nav-links { display: flex; gap: 4px; }

  .nav-link {
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
    letter-spacing: .15em;
    color: var(--silver);
    text-decoration: none;
    padding: 6px 14px;
    border: 1px solid transparent;
    transition: all .2s;
  }

  .nav-link:hover { color: var(--accent); border-color: var(--border); }
  .nav-link.active { color: var(--accent); border-color: var(--accent); }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .wrapper {
    max-width: 1440px;
    margin: 0 auto;
    padding: 32px clamp(16px, 2vw, 24px) 80px;
    position: relative;
    z-index: 1;
  }

  .page-header {
    margin-bottom: 32px;
  }

  .page-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px;
    letter-spacing: .3em;
    color: var(--accent);
    margin-bottom: 6px;
  }

  .page-title-main {
    font-family: 'Orbitron', sans-serif;
    font-size: 28px;
    font-weight: 900;
    letter-spacing: .1em;
    color: var(--white);
  }

  /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
  .card {
    background: rgba(12,18,32,.82);
    border: 1px solid var(--border);
    padding: 24px;
    margin-bottom: 24px;
    backdrop-filter: blur(12px);
  }
  .card h2 {
    font-size: 11px;
    letter-spacing: .2em;
    color: var(--silver);
    margin-bottom: 20px;
  }

  .form-row { display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap; }
  .form-group { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 200px; }
  label { font-size: 10px; letter-spacing: .15em; color: var(--silver); }

  input, textarea {
    background: var(--navy3);
    border: 1px solid var(--border);
    color: var(--white);
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    padding: 10px 14px;
    outline: none;
    width: 100%;
    resize: vertical;
  }
  input:focus, textarea:focus { border-color: var(--accent); }
  textarea { min-height: 80px; }

  .btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
    letter-spacing: .15em;
    padding: 10px 24px;
    border: 1px solid var(--accent);
    background: transparent;
    color: var(--accent);
    cursor: pointer;
    white-space: nowrap;
    transition: all .2s;
  }
  .btn:hover { background: rgba(74,143,212,.15); }
  .btn:disabled { opacity: .35; cursor: not-allowed; }
  .btn-danger { border-color: var(--red); color: var(--red); }
  .btn-danger:hover { background: rgba(255,68,68,.15); }
  .btn-launch { border-color: var(--green); color: var(--green); }
  .btn-launch:hover:not(:disabled) { background: rgba(61,220,132,.15); }

  .msg { font-size: 12px; padding: 10px 14px; margin-top: 12px; border-left: 3px solid var(--accent); background: rgba(74,143,212,.08); }
  .msg.error { border-color: var(--red); background: rgba(255,68,68,.08); color: var(--red); }
  .msg.warn { border-color: var(--orange); background: rgba(255,140,0,.08); color: var(--orange); }

  /* ‚îÄ‚îÄ CONSENT ‚îÄ‚îÄ */
  .consent {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin: 16px 0 12px;
    padding: 14px;
    border: 1px solid var(--orange);
    background: rgba(255,140,0,.06);
  }
  .consent input[type="checkbox"] {
    width: 16px; height: 16px;
    accent-color: var(--orange);
    flex-shrink: 0;
    margin-top: 2px;
  }
  .consent label {
    color: var(--orange);
    font-size: 12px;
    letter-spacing: .05em;
    cursor: pointer;
    line-height: 1.5;
  }

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  table { width: 100%; border-collapse: collapse; font-size: 12px; }
  th { text-align: left; font-size: 10px; letter-spacing: .15em; color: var(--silver); padding: 8px 12px; border-bottom: 1px solid var(--border); }
  td { padding: 12px; border-bottom: 1px solid rgba(74,143,212,.08); vertical-align: middle; }
  tr:hover td { background: rgba(74,143,212,.04); }

  .badge { display: inline-block; font-size: 9px; letter-spacing: .1em; padding: 3px 8px; border: 1px solid; }
  .badge-active { border-color: var(--green); color: var(--green); }
  .badge-completed { border-color: var(--accent); color: var(--accent); }
  .badge-draft { border-color: var(--silver); color: var(--silver); }

  .empty { color: var(--silver); font-size: 12px; text-align: center; padding: 32px; }

  /* ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
  }
  .stat-box {
    background: var(--navy3);
    border: 1px solid var(--border);
    padding: 14px;
    text-align: center;
  }
  .stat-val {
    font-family: 'Orbitron', sans-serif;
    font-size: 28px;
    font-weight: 900;
    line-height: 1;
    margin-bottom: 4px;
  }
  .stat-lbl {
    font-family: 'Share Tech Mono', monospace;
    font-size: 9px;
    letter-spacing: .2em;
    color: var(--silver);
  }

  /* ‚îÄ‚îÄ RESULTS DETAIL ‚îÄ‚îÄ */
  .result-panel {
    display: none;
  }
  .result-panel.on {
    display: block;
    animation: fadeup .35s ease;
  }
  @keyframes fadeup { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

  .event-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    border-bottom: 1px solid rgba(74,143,212,.06);
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
  }
  .event-row:hover { background: rgba(74,143,212,.04); }
  .event-icon { font-size: 14px; flex-shrink: 0; width: 20px; text-align: center; }
  .event-email { color: var(--white); flex: 1; }
  .event-time { color: var(--silver); font-size: 10px; }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  footer {
    text-align: center;
    margin-top: 52px;
    padding-top: 20px;
    border-top: 1px solid var(--border2);
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    color: rgba(74,143,212,.18);
    letter-spacing: .22em;
  }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media (max-width: 768px) {
    .form-row { flex-direction: column; }
    .form-group { min-width: 100%; }
    .btn { width: 100%; text-align: center; }
    nav { padding: 0 16px; }
    .nav-link { font-size: 10px; padding: 5px 10px; letter-spacing: .1em; }
    .nav-brand { font-size: 15px; }
    .page-title-main { font-size: 22px; }
  }

  @media (max-width: 480px) {
    .nav-brand span { display: none; }
    .wrapper { padding: 20px 12px 40px; }
    .card { padding: 16px; }
    .page-title-main { font-size: 18px; }
    footer { font-size: 8px; }
    .stat-val { font-size: 22px; }
  }
</style>
</head>
<body>
<nav>
  <a class="nav-brand" href="/ui">CYRBER<span>AUTONOMOUS RECON</span></a>
  <div class="nav-links">
    <a class="nav-link" href="/ui">SCAN</a>
    <a class="nav-link" href="/dashboard">DASHBOARD</a>
    <a class="nav-link" href="/scheduler">SCHEDULER</a>
    <a class="nav-link active" href="/phishing">PHISHING</a>
    <a class="nav-link" href="#" onclick="localStorage.removeItem('cyrber_token');window.location.href='/login'" style="color:var(--red)">LOGOUT</a>
  </div>
</nav>

<div class="wrapper">
  <div class="page-header">
    <div class="page-title">SOCIAL ENGINEERING</div>
    <div class="page-title-main">PHISHING CAMPAIGNS</div>
  </div>

  <!-- NEW CAMPAIGN -->
  <div class="card">
    <h2>// NOWA KAMPANIA</h2>

    <div class="form-row" style="margin-bottom:12px">
      <div class="form-group">
        <label>NAZWA KAMPANII</label>
        <input type="text" id="campName" placeholder="Q1 2026 Awareness Test">
      </div>
      <div class="form-group">
        <label>DOMENA NADAWCY</label>
        <input type="text" id="campDomain" placeholder="security-test.example.com">
      </div>
    </div>

    <div class="form-row" style="margin-bottom:12px">
      <div class="form-group">
        <label>SZABLON EMAILA (TEMAT)</label>
        <input type="text" id="campSubject" placeholder="Pilne: Zresetuj has≈Ço do konta firmowego">
      </div>
    </div>

    <div class="form-row" style="margin-bottom:12px">
      <div class="form-group">
        <label>TRE≈öƒÜ EMAILA (HTML)</label>
        <textarea id="campBody" placeholder="<p>Drogi pracowniku,</p><p>Wykryli≈õmy podejrzanƒÖ aktywno≈õƒá na Twoim koncie. Kliknij <a href='{{.URL}}'>tutaj</a> aby zweryfikowaƒá to≈ºsamo≈õƒá.</p>"></textarea>
      </div>
    </div>

    <div class="form-row" style="margin-bottom:12px">
      <div class="form-group">
        <label>LANDING PAGE URL</label>
        <input type="text" id="campLanding" placeholder="https://security-test.example.com/verify">
      </div>
    </div>

    <div class="form-group" style="margin-bottom:12px">
      <label>ODBIORCY (jeden email na liniƒô)</label>
      <textarea id="campTargets" placeholder="jan.kowalski@firma.pl&#10;anna.nowak@firma.pl&#10;piotr.wisniewski@firma.pl" style="min-height:100px"></textarea>
    </div>

    <div class="consent">
      <input type="checkbox" id="consentCheck">
      <label for="consentCheck">Potwierdzam posiadanie pisemnej zgody na przeprowadzenie testu social engineering wobec wymienionych odbiorc√≥w. Kampania jest prowadzona wy≈ÇƒÖcznie w celach edukacyjnych / audytowych na rzecz autoryzowanej organizacji.</label>
    </div>

    <div class="form-row">
      <button class="btn btn-launch" id="launchBtn" onclick="launchCampaign()" disabled>URUCHOM KAMPANIƒò</button>
    </div>

    <div id="msg"></div>
  </div>

  <!-- ACTIVE CAMPAIGNS -->
  <div class="card">
    <h2>// KAMPANIE</h2>
    <div id="campaigns-list"><div class="empty">≈Åadowanie...</div></div>
  </div>

  <!-- CAMPAIGN RESULTS (shown on click) -->
  <div class="card result-panel" id="resultPanel">
    <h2 id="resultTitle">// WYNIKI KAMPANII</h2>
    <div class="stats-row" id="resultStats"></div>
    <div id="resultEvents"><div class="empty">Brak zdarze≈Ñ</div></div>
  </div>

  <footer>CYRBER &nbsp;&middot;&nbsp; AUTONOMOUS RECON &nbsp;&middot;&nbsp; AUTHORIZED TARGETS ONLY &nbsp;&middot;&nbsp; v0.1.0</footer>
</div>

<script>
var API = '';

// ‚îÄ‚îÄ JWT Auth ‚îÄ‚îÄ
function getToken() { return localStorage.getItem('cyrber_token'); }
if (!getToken()) window.location.href = '/login';

function authHeaders(extra) {
  var token = getToken();
  if (!token) { window.location.href = '/login'; return {}; }
  var h = {'Authorization': 'Bearer ' + token};
  if (extra) Object.keys(extra).forEach(function(k){ h[k] = extra[k]; });
  return h;
}

async function authFetch(url, opts) {
  opts = opts || {};
  opts.headers = authHeaders(opts.headers || {});
  var r = await fetch(url, opts);
  if (r.status === 401) { localStorage.removeItem('cyrber_token'); window.location.href = '/login'; }
  return r;
}

// ‚îÄ‚îÄ consent checkbox enables launch button ‚îÄ‚îÄ
document.getElementById('consentCheck').addEventListener('change', function() {
  document.getElementById('launchBtn').disabled = !this.checked;
});

// ‚îÄ‚îÄ load campaigns ‚îÄ‚îÄ
async function fetchCampaigns() {
  try {
    var r = await authFetch('/phishing/campaigns');
    var data = await r.json();
    renderCampaigns(data);
  } catch(e) {
    document.getElementById('campaigns-list').innerHTML = '<div class="empty">B≈ÇƒÖd ≈Çadowania kampanii</div>';
  }
}

function renderCampaigns(campaigns) {
  var el = document.getElementById('campaigns-list');
  if (!campaigns || !campaigns.length) {
    el.innerHTML = '<div class="empty">Brak kampanii</div>';
    return;
  }
  var html = '<table><thead><tr><th>NAZWA</th><th>STATUS</th><th>WYS≈ÅANO</th><th>OTWARTO</th><th>KLIKNIƒòTO</th><th>CREDENTIALS</th><th>DATA</th><th></th></tr></thead><tbody>';
  campaigns.forEach(function(c) {
    var st = (c.status || 'unknown').toLowerCase();
    var badgeCls = st === 'completed' ? 'badge-completed' : (st === 'sending' || st === 'in progress' ? 'badge-active' : 'badge-draft');
    var stats = c.stats || {};
    var date = c.created_date ? c.created_date.replace('T',' ').slice(0,16) : '‚Äî';
    html += '<tr>';
    html += '<td style="color:var(--white)">' + (c.name || '‚Äî') + '</td>';
    html += '<td><span class="badge ' + badgeCls + '">' + (c.status || 'N/A').toUpperCase() + '</span></td>';
    html += '<td>' + (stats.sent || 0) + '</td>';
    html += '<td>' + (stats.opened || 0) + '</td>';
    html += '<td>' + (stats.clicked || 0) + '</td>';
    html += '<td style="color:' + ((stats.submitted_data||0) > 0 ? 'var(--red)' : 'var(--silver)') + '">' + (stats.submitted_data || 0) + '</td>';
    html += '<td>' + date + '</td>';
    html += '<td style="white-space:nowrap"><button class="btn" onclick="viewResults(' + c.id + ')" style="margin-right:6px">WYNIKI</button><button class="btn btn-danger" onclick="deleteCampaign(' + c.id + ')">USU≈É</button></td>';
    html += '</tr>';
  });
  html += '</tbody></table>';
  el.innerHTML = html;
}

// ‚îÄ‚îÄ launch campaign ‚îÄ‚îÄ
async function launchCampaign() {
  var name = document.getElementById('campName').value.trim();
  var domain = document.getElementById('campDomain').value.trim();
  var subject = document.getElementById('campSubject').value.trim();
  var body = document.getElementById('campBody').value.trim();
  var landing = document.getElementById('campLanding').value.trim();
  var rawTargets = document.getElementById('campTargets').value.trim();
  var consent = document.getElementById('consentCheck').checked;

  if (!consent) { showMsg('Wymagane potwierdzenie zgody', true); return; }
  if (!name) { showMsg('Podaj nazwƒô kampanii', true); return; }
  if (!domain) { showMsg('Podaj domenƒô nadawcy', true); return; }
  if (!subject) { showMsg('Podaj temat emaila', true); return; }
  if (!body) { showMsg('Podaj tre≈õƒá emaila', true); return; }
  if (!rawTargets) { showMsg('Podaj listƒô odbiorc√≥w', true); return; }

  var targets = rawTargets.split('\n').map(function(e){ return e.trim(); }).filter(function(e){ return e.length > 0 && e.includes('@'); });
  if (!targets.length) { showMsg('Brak poprawnych adres√≥w email', true); return; }

  document.getElementById('launchBtn').disabled = true;

  try {
    var r = await authFetch('/phishing/campaigns', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        name: name,
        domain: domain,
        subject: subject,
        email_body: body,
        landing_url: landing,
        targets: targets
      })
    });
    if (r.ok) {
      var data = await r.json();
      showMsg('Kampania "' + name + '" uruchomiona (' + targets.length + ' odbiorc√≥w)');
      document.getElementById('campName').value = '';
      document.getElementById('campTargets').value = '';
      document.getElementById('consentCheck').checked = false;
      document.getElementById('launchBtn').disabled = true;
      fetchCampaigns();
    } else {
      var err = await r.json();
      showMsg(err.detail || 'B≈ÇƒÖd tworzenia kampanii', true);
      document.getElementById('launchBtn').disabled = !document.getElementById('consentCheck').checked;
    }
  } catch(e) {
    showMsg('B≈ÇƒÖd po≈ÇƒÖczenia: ' + e.message, true);
    document.getElementById('launchBtn').disabled = !document.getElementById('consentCheck').checked;
  }
}

// ‚îÄ‚îÄ delete campaign ‚îÄ‚îÄ
async function deleteCampaign(id) {
  if (!confirm('UsunƒÖƒá kampaniƒô #' + id + '?')) return;
  try {
    var r = await authFetch('/phishing/campaigns/' + id, {
      method: 'DELETE'
    });
    if (r.ok) {
      fetchCampaigns();
      document.getElementById('resultPanel').classList.remove('on');
    }
  } catch(e) {}
}

// ‚îÄ‚îÄ view results ‚îÄ‚îÄ
async function viewResults(id) {
  try {
    var r = await authFetch('/phishing/campaigns/' + id + '/results');
    var data = await r.json();
    renderResults(data, id);
  } catch(e) {
    showMsg('B≈ÇƒÖd ≈Çadowania wynik√≥w', true);
  }
}

function renderResults(data, id) {
  var panel = document.getElementById('resultPanel');
  document.getElementById('resultTitle').textContent = '// WYNIKI KAMPANII #' + id;

  var stats = data.stats || {};
  var statsHtml = '';
  var items = [
    {val: stats.total || 0, lbl: 'WYS≈ÅANO', color: 'var(--accent)'},
    {val: stats.opened || 0, lbl: 'OTWARTO', color: 'var(--yellow)'},
    {val: stats.clicked || 0, lbl: 'KLIKNIƒòTO', color: 'var(--orange)'},
    {val: stats.submitted_data || 0, lbl: 'CREDENTIALS', color: 'var(--red)'},
    {val: stats.error || 0, lbl: 'B≈ÅƒòDY', color: 'var(--silver)'}
  ];
  items.forEach(function(it) {
    statsHtml += '<div class="stat-box"><div class="stat-val" style="color:' + it.color + '">' + it.val + '</div><div class="stat-lbl">' + it.lbl + '</div></div>';
  });
  document.getElementById('resultStats').innerHTML = statsHtml;

  var events = data.events || data.timeline || [];
  var evHtml = '';
  if (events.length) {
    var icons = {sent: 'üì®', opened: 'üëÅ', clicked: 'üñ±', submitted_data: 'üîë', error: '‚ö†'};
    events.forEach(function(ev) {
      var icon = icons[ev.message] || icons[ev.status] || '¬∑';
      var time = ev.time ? ev.time.replace('T',' ').slice(0,19) : '‚Äî';
      evHtml += '<div class="event-row"><div class="event-icon">' + icon + '</div><div class="event-email">' + (ev.email || '‚Äî') + '</div><div style="flex:1;color:var(--silver);font-size:10px">' + (ev.message || ev.status || '') + '</div><div class="event-time">' + time + '</div></div>';
    });
  } else {
    evHtml = '<div class="empty">Brak zdarze≈Ñ</div>';
  }
  document.getElementById('resultEvents').innerHTML = evHtml;

  panel.classList.add('on');
  panel.scrollIntoView({behavior: 'smooth'});
}

function showMsg(text, isError) {
  var el = document.getElementById('msg');
  el.className = 'msg' + (isError ? ' error' : '');
  el.textContent = text;
  setTimeout(function(){ el.textContent = ''; el.className = ''; }, 5000);
}

fetchCampaigns();
setInterval(fetchCampaigns, 30000);
</script>
</body>
</html>
