<!DOCTYPE html>
<html lang="en">
<head>
<script src="/static/theme.js"></script>
<link rel="stylesheet" href="/static/theme.css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CYRBER â€” Login</title>
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<link rel="icon" type="image/png" href="/static/favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  .theme-toggle{position:fixed;top:var(--sp-4);right:var(--sp-4);z-index:100}

  body {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 5vh;
  }

  .login-container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 400px;
    padding: 0 var(--sp-5);
  }

  .login-brand {
    position: fixed;
    top: 6vh;
    left: 0;
    right: 0;
    text-align: center;
    z-index: 1;
  }

  .login-brand h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 56px;
    font-weight: 900;
    letter-spacing: .2em;
    color: var(--text-primary);
  }

  .login-brand span {
    display: block;
    font-family: 'Orbitron', sans-serif;
    font-size: var(--text-sm);
    font-weight: 400;
    color: var(--accent);
    letter-spacing: .3em;
    margin-top: var(--sp-1);
  }

  .login-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: var(--sp-8);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: var(--card-shadow);
  }

  .login-card h2 {
    font-family: 'Share Tech Mono', monospace;
    font-size: var(--text-base);
    letter-spacing: .2em;
    color: var(--text-secondary);
    margin-bottom: var(--sp-6);
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--sp-1);
    margin-bottom: var(--sp-4);
  }

  label {
    font-family: 'Share Tech Mono', monospace;
    font-size: var(--text-sm);
    letter-spacing: .15em;
    color: var(--text-secondary);
  }

  input {
    background: var(--input-bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    font-family: 'Share Tech Mono', monospace;
    font-size: var(--text-md);
    padding: var(--sp-3) var(--sp-4);
    outline: none;
    width: 100%;
    transition: border-color .2s;
  }

  input:focus {
    border-color: var(--accent);
  }

  .btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: var(--text-base);
    letter-spacing: .15em;
    padding: var(--sp-3) var(--sp-6);
    border: 1px solid rgba(74,143,212,.3);
    border-radius: var(--radius-sm);
    background: var(--btn-primary-bg);
    color: #fff;
    cursor: pointer;
    width: 100%;
    margin-top: var(--sp-2);
    transition: all .2s;
  }

  .btn:hover {
    background: var(--btn-primary-hover);
    box-shadow: 0 0 24px var(--glow);
  }

  .msg {
    font-family: 'Share Tech Mono', monospace;
    font-size: var(--text-base);
    padding: var(--sp-2) var(--sp-4);
    margin-top: var(--sp-4);
    border-left: 3px solid var(--red);
    border-radius: var(--radius-sm);
    background: rgba(255,68,68,.08);
    color: var(--red);
    display: none;
  }

  .msg.visible { display: block; }

  footer {
    position: fixed;
    bottom: var(--sp-5);
    left: 0;
    right: 0;
    text-align: center;
    font-family: 'Share Tech Mono', monospace;
    font-size: var(--text-sm);
    color: var(--text-muted);
    letter-spacing: .22em;
    z-index: 1;
  }

  .bg-logo {
    position: fixed;
    top: 56%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 92vw;
    height: 92vh;
    max-width: 1200px;
    max-height: 1000px;
    background: url('/static/cyrber_wolf.png') center center / contain no-repeat;
    opacity: 0.04;
    pointer-events: none;
    z-index: 0;
  }

  @media (max-width: 768px) {
    .login-card { max-width: 360px; padding: var(--sp-6); }
    .login-brand h1 { font-size: 44px; }
  }
  @media (max-width: 480px) {
    .login-brand h1 { font-size: 36px; }
    .login-card { padding: var(--sp-6); }
    body { padding-bottom: 4vh; }
  }
</style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme"><span class="theme-toggle-icon"></span></button>

<div class="login-brand">
  <h1>CYRBER</h1>
  <span>AUTONOMOUS RECON</span>
</div>

<div class="bg-logo"></div>

<div class="login-container">
  <div class="login-card">
    <h2>// AUTHENTICATION REQUIRED</h2>
    <form id="loginForm" onsubmit="doLogin(event)">
      <div class="form-group">
        <label>USERNAME</label>
        <input type="text" id="username" autocomplete="username" autofocus required>
      </div>
      <div class="form-group">
        <label>PASSWORD</label>
        <input type="password" id="password" autocomplete="current-password" required>
      </div>
      <button type="submit" class="btn">AUTHENTICATE</button>
    </form>
    <div class="msg" id="msg"></div>
  </div>
</div>

<footer>CYRBER &nbsp;&middot;&nbsp; AUTONOMOUS RECON &nbsp;&middot;&nbsp; AUTHORIZED TARGETS ONLY &nbsp;&middot;&nbsp; v0.1.0</footer>

<script>
// If already authenticated, redirect to /ui
if (localStorage.getItem('cyrber_token')) {
  window.location.href = '/ui';
}

async function doLogin(e) {
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const msg = document.getElementById('msg');

  msg.classList.remove('visible');

  try {
    const r = await fetch('/auth/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({username, password})
    });

    if (r.ok) {
      const data = await r.json();
      localStorage.setItem('cyrber_token', data.token);
      // Remove old Basic Auth credentials
      localStorage.removeItem('cyrber_creds');
      window.location.href = '/ui';
    } else if (r.status === 429) {
      msg.textContent = 'Too many attempts. Try again later.';
      msg.classList.add('visible');
    } else {
      msg.textContent = 'Invalid credentials';
      msg.classList.add('visible');
    }
  } catch(err) {
    msg.textContent = 'Connection error';
    msg.classList.add('visible');
  }
}
</script>
</body>
</html>
